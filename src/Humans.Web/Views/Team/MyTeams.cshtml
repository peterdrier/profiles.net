@model Humans.Web.Models.MyTeamsViewModel
@{
    ViewData["Title"] = Localizer["MyTeams_Title"].Value;
}

<h1>@Localizer["MyTeams_Title"]</h1>

<vc:temp-data-alerts />

@if (Model.Memberships.Any())
{
    <div class="card mb-4">
        <div class="card-header">@Localizer["MyTeams_TeamMemberships"]</div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>@Localizer["MyTeams_Team"]</th>
                        <th>@Localizer["MyTeams_Role"]</th>
                        <th>@Localizer["MyTeams_Joined"]</th>
                        <th>@Localizer["MyTeams_Actions"]</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var membership in Model.Memberships)
                    {
                        <tr>
                            <td>
                                <a asp-action="Details" asp-route-slug="@membership.TeamSlug">@membership.TeamName</a>
                                @if (membership.IsSystemTeam)
                                {
                                    <span class="badge bg-secondary ms-1">@Localizer["Teams_System"]</span>
                                }
                            </td>
                            <td>
                                @await Html.PartialAsync("_RoleBadge", membership.IsLead ? TeamMemberRole.Lead : TeamMemberRole.Member)
                            </td>
                            <td>@membership.JoinedAt.ToString("MMM d, yyyy")</td>
                            <td>
                                <a asp-action="Details" asp-route-slug="@membership.TeamSlug" class="btn btn-sm btn-outline-primary">@Localizer["MyTeams_View"]</a>
                                @if (membership.IsLead)
                                {
                                    <a asp-controller="TeamAdmin" asp-action="Members" asp-route-slug="@membership.TeamSlug" class="btn btn-sm btn-outline-secondary">
                                        @Localizer["Teams_Manage"]
                                        @if (membership.PendingRequestCount > 0)
                                        {
                                            <span class="badge bg-warning ms-1">@membership.PendingRequestCount</span>
                                        }
                                    </a>
                                }
                                @if (membership.CanLeave)
                                {
                                    <form asp-action="Leave" asp-route-slug="@membership.TeamSlug" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-outline-danger" data-confirm="@string.Format(Localizer["MyTeams_LeaveConfirm"].Value, membership.TeamName)">
                                            @Localizer["MyTeams_Leave"]
                                        </button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div class="alert alert-info">
        @Localizer["MyTeams_NoTeams"] <a asp-action="Index">@Localizer["MyTeams_BrowseTeams"]</a>
    </div>
}

@if (Model.PendingRequests.Any())
{
    <div class="card">
        <div class="card-header">@Localizer["MyTeams_PendingRequests"]</div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>@Localizer["MyTeams_Team"]</th>
                        <th>@Localizer["MyTeams_Status"]</th>
                        <th>@Localizer["MyTeams_Requested"]</th>
                        <th>@Localizer["MyTeams_Actions"]</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var request in Model.PendingRequests)
                    {
                        <tr>
                            <td>
                                <a asp-action="Details" asp-route-slug="@request.TeamSlug">@request.TeamName</a>
                            </td>
                            <td>
                                <span class="badge @request.StatusBadgeClass">@request.Status</span>
                            </td>
                            <td>@request.RequestedAt.ToString("MMM d, yyyy")</td>
                            <td>
                                <form asp-action="WithdrawRequest" asp-route-id="@request.Id" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-outline-danger" data-confirm="@Localizer["MyTeams_WithdrawConfirm"].Value">
                                        @Localizer["MyTeams_Withdraw"]
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
